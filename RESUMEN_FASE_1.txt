â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MS ML DESPACHO - FASE 1: IMPLEMENTACIÃ“N COMPLETA
  Reglas DeterminÃ­sticas + RecolecciÃ³n de Datos
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTADO: âœ… COMPLETADO - Listo para ImplementaciÃ³n

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. ARQUITECTURA IMPLEMENTADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SQL SERVER DATABASE                       â”‚
â”‚                    ms_ml_despacho                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Schema: ml                                                  â”‚
â”‚  â”œâ”€ assignment_history          â† PRINCIPAL (datos training)â”‚
â”‚  â”œâ”€ trained_models              â† Registro de modelos       â”‚
â”‚  â”œâ”€ predictions_log             â† AuditorÃ­a predicciones    â”‚
â”‚  â”œâ”€ features_cache              â† Cache optimizaciÃ³n        â”‚
â”‚  â”œâ”€ model_configuration         â† Config de reglas          â”‚
â”‚  â”œâ”€ metrics_summary             â† KPIs agregados            â”‚
â”‚  â”œâ”€ audit_log                   â† Log de cambios            â”‚
â”‚  â””â”€ Vistas + Stored Procedures  â† Helpers Ãºtiles            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     PYTHON MICROSERVICE - FASE 1     â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ DispatchAssignmentService            â”‚
         â”‚ â”œâ”€ Regla 1: Ambulancia mÃ¡s cercana   â”‚
         â”‚ â”œâ”€ Regla 2: Validar disponibilidad   â”‚
         â”‚ â””â”€ Regla 3: Personal por severidad   â”‚
         â”‚                                      â”‚
         â”‚ AssignmentHistoryRepository          â”‚
         â”‚ â”œâ”€ Crear registros histÃ³rico         â”‚
         â”‚ â”œâ”€ Leer datos para estadÃ­sticas      â”‚
         â”‚ â””â”€ Obtener datos para entrenar ML    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      REST API - 9 ENDPOINTS          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ POST   /api/v1/dispatch/assign       â”‚
         â”‚ POST   /api/v1/dispatch/assign/batchâ”‚
         â”‚ GET    /api/v1/dispatch/history/... â”‚
         â”‚ GET    /api/v1/dispatch/statistics  â”‚
         â”‚ ...                                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2. ARCHIVOS CREADOS (5)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. scripts/01_create_schema.sql
   â”œâ”€ 8 tablas SQL Server
   â”œâ”€ Ãndices optimizados
   â”œâ”€ Stored Procedures
   â”œâ”€ Vistas para reportes
   â”œâ”€ Constraints y validaciones
   â””â”€ Seed data (configuraciÃ³n Fase 1)

   âœ Ejecutar: sqlcmd -d ms_ml_despacho -i scripts/01_create_schema.sql

2. src/services/dispatch_assignment_service.py
   â”œâ”€ DispatchAssignmentService (700+ lÃ­neas)
   â”œâ”€ MÃ©todos:
   â”‚  â”œâ”€ assign_ambulance_and_personnel()    â† PRINCIPAL
   â”‚  â”œâ”€ _select_ambulance()                 â† Regla 1
   â”‚  â”œâ”€ _assign_paramedics()                â† Regla 3
   â”‚  â”œâ”€ _calculate_distance()               â† Haversine
   â”‚  â””â”€ _validate_input_data()              â† ValidaciÃ³n
   â””â”€ Logging y manejo de errores robusto

3. src/repositories/assignment_history_repository.py
   â”œâ”€ AssignmentHistoryRepository (500+ lÃ­neas)
   â”œâ”€ Operaciones CRUD:
   â”‚  â”œâ”€ create_assignment_history()
   â”‚  â”œâ”€ get_assignment_by_dispatch()
   â”‚  â”œâ”€ get_recent_assignments()
   â”‚  â”œâ”€ get_assignments_for_training()
   â”‚  â””â”€ ... 10+ mÃ©todos mÃ¡s
   â””â”€ EstadÃ­sticas y anÃ¡lisis

4. src/api/dispatch_assignment_routes.py
   â”œâ”€ Blueprint Flask con 9 endpoints
   â”œâ”€ /assign             â†’ Asignar ambulancia
   â”œâ”€ /assign/batch       â†’ Asignaciones lote
   â”œâ”€ /history/*          â†’ Obtener histÃ³rico
   â”œâ”€ /statistics         â†’ EstadÃ­sticas
   â””â”€ /health             â†’ Health check

5. DocumentaciÃ³n (3 archivos)
   â”œâ”€ FASE_1_IMPLEMENTATION_GUIDE.md      (GuÃ­a 120+ lÃ­neas)
   â”œâ”€ scripts/SCHEMA_DIAGRAM.md           (Diagrama ER)
   â””â”€ IMPLEMENTATION_CHECKLIST.md         (Checklist ejecutable)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
3. CÃ“MO FUNCIONA FASE 1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ENTRADA:
{
    "dispatch_id": 123,
    "patient_latitude": 4.7110,
    "patient_longitude": -74.0721,
    "emergency_type": "trauma",
    "severity_level": 4,
    "available_ambulances": [{id: 1, lat: 4.7120, lon: -74.0700, ...}],
    "available_paramedics": [{id: 1, level: "senior", ...}, ...],
    "available_nurses": [...]
}

PROCESO:
1. Validar entrada
   âœ“ Â¿Tiene todos los campos requeridos?
   âœ“ Â¿Son vÃ¡lidos los valores?

2. Aplicar REGLA 1: Ambulancia mÃ¡s cercana
   â”œâ”€ Calcular distancia GPS cada ambulancia (Haversine)
   â”œâ”€ Filtrar: mÃ¡ximo 15km
   â”œâ”€ Ordenar por distancia
   â””â”€ Seleccionar la mÃ¡s cercana â†’ AMBULANCIA_ID
   â””â”€ Confianza: 0.5-0.95 segÃºn distancia

3. Aplicar REGLA 3: Personal por severidad
   â”œâ”€ Severidad 5 (CrÃ­tico): 3 paramÃ©dicos + enfermero
   â”œâ”€ Severidad 4 (Alto):    2 paramÃ©dicos + enfermero
   â”œâ”€ Severidad 3 (Medio):   2 paramÃ©dicos
   â”œâ”€ Severidad 2 (Bajo-M):  1 paramÃ©dico
   â””â”€ Severidad 1 (Bajo):    1 paramÃ©dico
   â””â”€ Fallback automÃ¡tico a siguiente nivel si no hay disponibilidad

4. Guardar en BD (ml.assignment_history)
   â”œâ”€ Features: location, time, emergency_type, severity, availability, etc
   â”œâ”€ Target: ambulance_id, paramedic_ids
   â””â”€ Post-asignaciÃ³n: response_time, outcome (se llena despuÃ©s)

SALIDA:
{
    "success": true,
    "ambulance_id": 1,           â† Ambulancia asignada
    "paramedic_ids": [1, 2],     â† Personal asignado
    "nurse_id": 10,              â† Enfermero (si aplica)
    "distance_km": 0.25,         â† Distancia
    "confidence": 0.92,          â† Confianza (0-1)
    "assignment_type": "deterministic_rules",
    "phase": 1,
    "reasoning": "...",
    "history_id": 456            â† Para actualizar despuÃ©s
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
4. INTEGRACIÃ“N CON TUS MICROSERVICIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Flujo completo del sistema:

n8n / MS-RECEPCIÃ“N
    â†“
    Solicitud ambulancia (GPS, tipo emergencia, etc)
    â†“
MS-ML-DESPACHO (Fase 1)
    â”œâ”€ POST /api/v1/dispatch/assign
    â”œâ”€ Aplica reglas determinÃ­sticas
    â”œâ”€ Retorna: {ambulance_id, paramedic_ids, confidence}
    â””â”€ Guarda en ml.assignment_history
    â†“
MS-DESPACHO (Node.js)
    â”œâ”€ Recibe asignaciÃ³n
    â”œâ”€ Valida en su BD
    â”œâ”€ Ejecuta despacho real
    â”œâ”€ Notifica paramÃ©dico
    â””â”€ Registra resultado
    â†“
DespuÃ©s (cuando termina la atenciÃ³n):
    â”œâ”€ MS-DESPACHO notifica resultado
    â””â”€ MS-ML-DESPACHO actualiza:
       - actual_response_time_minutes
       - patient_outcome
       - was_optimal (para evaluaciÃ³n)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
5. REGLAS IMPLEMENTADAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

REGLA 1: AMBULANCIA MÃS CERCANA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Algoritmo:
  1. Filtrar ambulancias con status = "available"
  2. Calcular distancia GPS (Haversine) a ubicaciÃ³n emergencia
  3. Aplicar mÃ¡ximo: 15km (configurable)
  4. Retornar la de menor distancia

Confianza:
  - 0-2km   â†’ 0.95 (muy cercana)
  - 2-5km   â†’ 0.85 (cercana)
  - 5-10km  â†’ 0.70 (distancia media)
  - 10-15km â†’ 0.50 (lejos)

Fallback:
  Si no hay ambulancias disponibles â†’ Error


REGLA 2: VALIDACIÃ“N DE DISPONIBILIDAD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Automatizado en la funciÃ³n _select_ambulance()
  - Filtra por status = "available"
  - Valida que estÃ© dentro de rango de servicio


REGLA 3: ASIGNACIÃ“N DE PERSONAL POR SEVERIDAD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Severidad 5 (CrÃ­tico/Extremo):
  â”œâ”€ Cantidad: 3 paramÃ©dicos
  â”œâ”€ Niveles: [senior, senior, junior]
  â”œâ”€ Enfermero: SÃ
  â””â”€ Especialista: SÃ
  â””â”€ Confianza: 0.95

Severidad 4 (Alto):
  â”œâ”€ Cantidad: 2 paramÃ©dicos
  â”œâ”€ Niveles: [senior, junior]
  â”œâ”€ Enfermero: SÃ
  â””â”€ Confianza: 0.85

Severidad 3 (Medio):
  â”œâ”€ Cantidad: 2 paramÃ©dicos
  â”œâ”€ Niveles: [junior, junior]
  â””â”€ Confianza: 0.75

Severidad 2 (Bajo-Medio):
  â”œâ”€ Cantidad: 1 paramÃ©dico
  â”œâ”€ Nivel: [junior]
  â””â”€ Confianza: 0.70

Severidad 1 (Bajo):
  â”œâ”€ Cantidad: 1 paramÃ©dico
  â”œâ”€ Nivel: [junior]
  â””â”€ Confianza: 0.65

Fallback:
  - Si no hay nivel requerido â†’ usar nivel superior (senior â†’ junior)
  - Si no hay paramÃ©dicos â†’ Error

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
6. API ENDPOINTS (9 TOTAL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. POST /api/v1/dispatch/assign
   â”œâ”€ PropÃ³sito: Asignar ambulancia y personal
   â”œâ”€ Body: dispatch_data (ver secciÃ³n 3)
   â””â”€ Retorna: AsignaciÃ³n con ambulancia, personal, confianza

2. POST /api/v1/dispatch/assign/batch
   â”œâ”€ PropÃ³sito: Asignar mÃºltiples en lote
   â”œâ”€ Body: {dispatches: [dispatch1, dispatch2, ...]}
   â””â”€ Retorna: Array de resultados

3. GET /api/v1/dispatch/history/<dispatch_id>
   â”œâ”€ PropÃ³sito: Obtener histÃ³rico de una asignaciÃ³n
   â””â”€ Retorna: Datos completos del registro

4. GET /api/v1/dispatch/history/recent?limit=50&hours=24
   â”œâ”€ PropÃ³sito: Ãšltimas asignaciones
   â””â”€ Query params: limit (max 500), hours

5. GET /api/v1/dispatch/history/ambulance/<ambulance_id>
   â”œâ”€ PropÃ³sito: HistÃ³rico de una ambulancia
   â””â”€ Retorna: Todas las asignaciones de esa ambulancia

6. GET /api/v1/dispatch/statistics?hours=24
   â”œâ”€ PropÃ³sito: EstadÃ­sticas globales
   â””â”€ Retorna: total, optimal_rate, avg_response_time, etc

7. GET /api/v1/dispatch/statistics/ambulance/<ambulance_id>?hours=168
   â”œâ”€ PropÃ³sito: DesempeÃ±o de una ambulancia
   â””â”€ Retorna: Performance metrics especÃ­ficas

8. GET /api/v1/dispatch/statistics/severity-distribution?hours=168
   â”œâ”€ PropÃ³sito: DistribuciÃ³n de asignaciones por severidad
   â””â”€ Retorna: {1: count, 2: count, ...}

9. GET /api/v1/dispatch/health
   â”œâ”€ PropÃ³sito: Health check
   â””â”€ Retorna: Status, timestamp

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
7. RECOLECCIÃ“N DE DATOS (PLAN)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Objetivo de Fase 1:
  â”œâ”€ Recolectar 500-1000 registros histÃ³ricos
  â”œâ”€ Usar reglas determinÃ­sticas (sin ML)
  â”œâ”€ DuraciÃ³n: 2-3 meses
  â””â”€ PrÃ³ximo: Entrenar modelo XGBoost en Fase 2

Plan de recolecciÃ³n:
  Semana 1-2:   Deployment y testing (0 registros)
  Semana 3-4:   Primer mes live (100-150 registros)
  Mes 2:        (200-300 registros)
  Mes 3:        (200-250 registros)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total 3 meses: ~600-800 registros âœ“ Suficiente para ML

QuÃ© se guarda automÃ¡ticamente:
  FEATURES (Input):
    â”œâ”€ UbicaciÃ³n: latitude, longitude, zone_code
    â”œâ”€ Contexto: hour_of_day, day_of_week, is_weekend
    â”œâ”€ Emergencia: emergency_type, severity_level
    â”œâ”€ Disponibilidad: ambulances_count, paramedics_count, busy_%
    â””â”€ HistÃ³rico: avg_response_time_zone, active_dispatches

  TARGET (Output):
    â”œâ”€ assigned_ambulance_id       â† Lo que queremos predecir
    â”œâ”€ assigned_paramedic_ids      â† Lo que queremos predecir
    â””â”€ assigned_paramedic_levels

  POST-ASIGNACIÃ“N (Se llena despuÃ©s):
    â”œâ”€ actual_response_time_minutes
    â”œâ”€ patient_outcome
    â”œâ”€ was_optimal                  â† LABEL para entrenar
    â””â”€ optimization_score

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
8. PASOS DE IMPLEMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: Base de Datos (30 min)
  [ ] Conectarse a SQL Server
  [ ] Crear BD: CREATE DATABASE ms_ml_despacho;
  [ ] Ejecutar: scripts/01_create_schema.sql
  [ ] Verificar: SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'ml';

PASO 2: IntegraciÃ³n Python (1-2 horas)
  [ ] Copiar 3 archivos a proyecto:
      - src/services/dispatch_assignment_service.py
      - src/repositories/assignment_history_repository.py
      - src/api/dispatch_assignment_routes.py
  [ ] Instalar deps: pip install sqlalchemy python-dotenv
  [ ] Configurar DB_URL en .env
  [ ] Registrar blueprint en main.py:
      app.register_blueprint(dispatch_assignment_bp)

PASO 3: Testing (2-3 horas)
  [ ] Verificar health: curl http://localhost:5000/api/v1/dispatch/health
  [ ] Enviar asignaciÃ³n prueba
  [ ] Verificar que se guardÃ³ en BD
  [ ] Obtener estadÃ­sticas
  [ ] Revisar logs

PASO 4: IntegraciÃ³n MS-DESPACHO (4-6 horas)
  [ ] Llamar /api/v1/dispatch/assign desde ms-despacho
  [ ] Usar resultado para asignar ambulancia
  [ ] Notificar paramÃ©dico
  [ ] Actualizar resultado cuando termina despacho

PASO 5: ProducciÃ³n (2-3 horas)
  [ ] Configurar variables de entorno
  [ ] Backup automÃ¡tico de BD
  [ ] Configurar logging y alertas
  [ ] Monitoreo 24/7

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL: ~10-16 horas de implementaciÃ³n
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
9. PRÃ“XIMOS PASOS (FASE 2)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Cuando tengas 500+ registros en ml.assignment_history (en 2-3 meses):

1. ENTRENAR MODELO XGBOOST
   â”œâ”€ Cargar datos histÃ³ricos
   â”œâ”€ Preparar features y target
   â”œâ”€ Entrenar modelo: XGBClassifier(n_estimators=100)
   â”œâ”€ Evaluar accuracy (esperado: 85-95%)
   â””â”€ Guardar en models/ambulance_selector_v1.pkl

2. REGISTRAR MODELO EN BD
   â”œâ”€ INSERT ml.trained_models con metadata
   â”œâ”€ Guardar accuracy, f1_score, feature_importance
   â””â”€ Marcar como is_active = 1

3. CAMBIAR LÃ“GICA A PREDICCIÃ“N ML
   â”œâ”€ Modificar DispatchAssignmentService
   â”œâ”€ Cambiar de _assign_with_deterministic_rules() a _assign_with_ml_model()
   â”œâ”€ Cargar modelo XGBoost
   â”œâ”€ Hacer predicciÃ³n en lugar de reglas
   â””â”€ Registrar en ml.predictions_log

4. COMPARAR DESEMPEÃ‘O
   â”œâ”€ Fase 1 (reglas): ~85% optimal_rate esperado
   â”œâ”€ Fase 2 (ML):     ~90-95% optimal_rate esperado
   â””â”€ Ganancia: +5-10% de asignaciones Ã³ptimas

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
10. SOPORTE Y TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA: "No ambulances available"
CAUSA: Todas las ambulancias estÃ¡n >15km
SOLUCIÃ“N: Aumentar AMBULANCE_MAX_DISTANCE_KM en config

PROBLEMA: "No paramedics available"
CAUSA: No hay paramÃ©dicos disponibles
SOLUCIÃ“N: Fallback automÃ¡tico (se intenta nivel superior)

PROBLEMA: Health check retorna error
CAUSA: BD no conectada
SOLUCIÃ“N: Verificar DATABASE_URL en .env

PROBLEMA: Endpoints no responden
CAUSA: Blueprint no registrado en main.py
SOLUCIÃ“N: Agregar app.register_blueprint(dispatch_assignment_bp)

PROBLEMA: Lento asignar ambulancia
CAUSA: Demasiadas ambulancias o cÃ¡lculos ineficientes
SOLUCIÃ“N: Optimizar consulta, agregar Ã­ndices, usar Ã­ndice geoespacial

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
11. MÃ‰TRICAS Y MONITOREO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KPIs a Monitorear:
  â”œâ”€ total_assignments (por dÃ­a/semana/mes)
  â”œâ”€ optimal_rate (% asignaciones Ã³ptimas) - Objetivo: >85%
  â”œâ”€ avg_response_time_minutes - Objetivo: <5 min
  â”œâ”€ avg_distance_km - Seguimiento
  â”œâ”€ paramedic_satisfaction (1-5) - Objetivo: >4
  â”œâ”€ patient_satisfaction (1-5) - Objetivo: >4
  â”œâ”€ assignment_error_rate (% fallos) - Objetivo: <1%
  â””â”€ db_size (crecimiento datos) - Seguimiento

Queries Ãºtiles:
  -- Optimal rate Ãºltimo dÃ­a
  SELECT CAST(COUNT(CASE WHEN was_optimal = 1 THEN 1 END) as FLOAT) / COUNT(*) * 100
  FROM ml.assignment_history WHERE created_at > DATEADD(DAY, -1, GETUTCDATE());

  -- Response time promedio por hora
  SELECT HOUR(created_at) as hour, AVG(actual_response_time_minutes) as avg_time
  FROM ml.assignment_history WHERE created_at > DATEADD(DAY, -1, GETUTCDATE())
  GROUP BY HOUR(created_at);

  -- DistribuciÃ³n por severidad
  SELECT severity_level, COUNT(*) as count
  FROM ml.assignment_history GROUP BY severity_level;

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… COMPLETADO:
  â€¢ Esquema SQL Server 100% con 8 tablas
  â€¢ Servicio Python Fase 1 (700+ lÃ­neas)
  â€¢ Repositorio datos (500+ lÃ­neas)
  â€¢ 9 endpoints REST documentados
  â€¢ DocumentaciÃ³n completa (3 archivos)

â° PRÃ“XIMAS ACCIONES:
  1. Ejecutar script SQL (scripts/01_create_schema.sql)
  2. Integrar cÃ³digo Python en tu proyecto
  3. Registrar blueprint Flask
  4. Testing bÃ¡sico con curl
  5. IntegraciÃ³n con ms-despacho
  6. Deploy a producciÃ³n
  7. Monitoreo 2-3 meses (recolectar datos)
  8. Entrenar modelo XGBoost (Fase 2)

ğŸ“Š VISIÃ“N A LARGO PLAZO:
  Fase 1 (Ahora):      Reglas determinÃ­sticas + recolectar datos
  Fase 2 (En 3 meses): Modelo XGBoost + predicciones
  Fase 3 (Futuro):     Multi-modelo, optimizaciÃ³n continua

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Â¡LISTO PARA IMPLEMENTACIÃ“N!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
